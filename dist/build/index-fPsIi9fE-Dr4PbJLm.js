const __vite__fileDeps=["index-C9ULowyk-BJkHGaYY.js","strapi-CYDWDzAt.js","strapi-COJtagOC.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{h as f,fn as q,fo as k,fp as Ge,d as Y,r as y,_ as _e,fq as He,aR as O,u as v,fr as d,a as e,P as w,R as Ne,b as je,B as U,T as ee,as as We,fs as Je,ar as Se,br as ke,ft as Ke,fu as P,fv as Xe,fw as Ze,fx as Ye,fy as es,fz as ss,fA as E,fB as ts,c as $,ad as Le,fC as as,I as W,ba as os,bz as Re,d6 as ns,fD as is,dw as rs,bi as ls,fE as ds,fF as cs,U as X,fG as us,J as fs,fH as gs,fI as ps,F as Q,V as hs,b6 as ms,fJ as xs,aU as J,fK as js,fL as bs,fM as ys,fN as vs,fO as Fs,c4 as Cs,W as L,bh as Z,ap as be,aq as Ms,fP as Ss,fQ as ye,fR as ks,fS as Ls,e as Rs,a6 as ws,a7 as As,fT as Es,bm as ve,bl as Ts,bn as Ds,M as b,ds as Bs,fU as Is,aV as Ps,Q as $s,S as qs,X as Fe,fV as Os,q as Us,o as Qs,s as zs,z as Vs,fW as K,fX as Gs,eO as _s}from"./strapi-CYDWDzAt.js";const Hs=(s,{pathname:a,query:o})=>{let n=[{id:null,label:{id:d("plugin.name"),defaultMessage:"Media Library"},href:s?E(a,o||{}):void 0}];return s?.parent&&typeof s?.parent!="number"&&s?.parent?.parent&&n.push([]),s?.parent&&typeof s.parent!="number"&&n.push({id:s.parent.id,label:s.parent.name,href:E(a,o||{},{folder:s.parent.id?.toString(),folderPath:s.parent.path})}),s&&n.push({id:s.id,label:s.name}),n},Ns=s=>{const{id:a}=vs();return e.jsx(U,{position:"relative",zIndex:2,children:e.jsx(Le,{"aria-labelledby":`${a}-title`,...s})})},we=({selected:s,onSuccess:a})=>{const{formatMessage:o}=v(),{remove:n}=Es(),l=async()=>{await n(s),a()};return e.jsxs(ve.Root,{children:[e.jsx(ve.Trigger,{children:e.jsx(L,{variant:"danger-light",size:"S",startIcon:e.jsx(Ts,{}),children:o({id:"global.delete",defaultMessage:"Delete"})})}),e.jsx(Ds,{onConfirm:l})]})};we.propTypes={selected:f.arrayOf(q,k).isRequired,onSuccess:f.func.isRequired};const Ws=()=>{const{formatMessage:s}=v(),{toggleNotification:a}=Us(),o=Qs(),{post:n}=zs(),i=Vs(({destinationFolderId:h,filesAndFolders:p})=>{const c=p.reduce((u,M)=>{const{id:r,type:S}=M,m=S==="asset"?"fileIds":"folderIds";return u[m]||(u[m]=[]),u[m].push(r),u},{});return n("/upload/actions/bulk-move",{...c,destinationFolderId:h})},{onSuccess(h){const{data:{data:p}}=h;p?.files?.length>0&&(o.refetchQueries([K,"assets"],{active:!0}),o.refetchQueries([K,"asset-count"],{active:!0})),o.refetchQueries([K,"folders"],{active:!0}),a({type:"success",message:s({id:d("modal.move.success-label"),defaultMessage:"Elements have been moved successfully."})})}});return{...i,move:(h,p)=>i.mutateAsync({destinationFolderId:h,filesAndFolders:p})}},se=({onClose:s,selected:a,currentFolder:o})=>{const{formatMessage:n}=v(),{data:l,isLoading:i}=Is(),{move:g}=Ws();if(!l)return null;const h=async(c,{setErrors:u})=>{try{await g(c.destination.value,a),s()}catch(M){const S=Gs(M).errors.reduce((m,T)=>(m[T.values?.path?.length||"destination"]=T.defaultMessage,m),{});_s(S)||u(S)}};if(i)return e.jsx(b.Content,{children:e.jsx(b.Body,{children:e.jsx(Q,{justifyContent:"center",paddingTop:4,paddingBottom:4,children:e.jsx(Ps,{children:n({id:d("content.isLoading"),defaultMessage:"Content is loading."})})})})});const p={destination:{value:o?.id||"",label:o?.name||l[0].label}};return e.jsx(b.Content,{children:e.jsx($s,{validateOnChange:!1,onSubmit:h,initialValues:p,children:({values:c,errors:u,setFieldValue:M})=>e.jsxs(qs,{noValidate:!0,children:[e.jsx(b.Header,{children:e.jsx(b.Title,{children:n({id:d("modal.folder.move.title"),defaultMessage:"Move elements to"})})}),e.jsx(b.Body,{children:e.jsx(X.Root,{gap:4,children:e.jsx(X.Item,{xs:12,col:12,direction:"column",alignItems:"stretch",children:e.jsxs(Fe.Root,{id:"folder-destination",children:[e.jsx(Fe.Label,{children:n({id:d("form.input.label.folder-location"),defaultMessage:"Location"})}),e.jsx(Os,{options:l,onChange:r=>{M("destination",r)},defaultValue:c.destination,name:"destination",menuPortalTarget:document.querySelector("body"),inputId:"folder-destination",error:u?.destination,ariaErrorMessage:"destination-error"}),u.destination&&e.jsx(ee,{variant:"pi",tag:"p",textColor:"danger600",children:u.destination})]})})})}),e.jsxs(b.Footer,{children:[e.jsx(b.Close,{children:e.jsx(L,{variant:"tertiary",name:"cancel",children:n({id:"cancel",defaultMessage:"Cancel"})})}),e.jsx(L,{type:"submit",loading:i,children:n({id:"modal.folder.move.submit",defaultMessage:"Move"})})]})]})})})};se.defaultProps={currentFolder:void 0,selected:[]};se.propTypes={onClose:f.func.isRequired,currentFolder:k,selected:f.arrayOf(k,q)};const te=({selected:s,onSuccess:a,currentFolder:o})=>{const{formatMessage:n}=v(),[l,i]=y.useState(!1),g=()=>{i(!1),a()};return e.jsxs(b.Root,{open:l,onOpenChange:i,children:[e.jsx(b.Trigger,{children:e.jsx(L,{variant:"secondary",size:"S",startIcon:e.jsx(Bs,{}),children:n({id:"global.move",defaultMessage:"Move"})})}),e.jsx(se,{currentFolder:o,onClose:g,selected:s})]})};te.defaultProps={currentFolder:void 0,selected:[]};te.propTypes={onSuccess:f.func.isRequired,currentFolder:k,selected:f.arrayOf(q,k)};const ae=({selected:s,onSuccess:a,currentFolder:o})=>{const{formatMessage:n}=v(),l=s.reduce(function(i,g){return g?.type==="folder"?i+g.files.count:i+1},0);return e.jsxs(Q,{gap:2,paddingBottom:5,children:[e.jsx(ee,{variant:"epsilon",textColor:"neutral600",children:n({id:d("list.assets.selected"),defaultMessage:"{numberFolders, plural, one {1 folder} other {# folders}} - {numberAssets, plural, one {1 asset} other {# assets}} selected"},{numberFolders:s.filter(({type:i})=>i==="folder").length,numberAssets:l})}),e.jsx(we,{selected:s,onSuccess:a}),e.jsx(te,{currentFolder:o,selected:s,onSuccess:a})]})};ae.defaultProps={currentFolder:void 0,selected:[]};ae.propTypes={onSuccess:f.func.isRequired,currentFolder:k,selected:f.arrayOf(q,k)};const Js=({isFiltering:s,canCreate:a,canRead:o})=>s?{id:"list.assets-empty.title-withSearch",defaultMessage:"There are no elements with the applied filters"}:o?a?{id:"list.assets.empty-upload",defaultMessage:"Upload your first assets..."}:{id:"list.assets.empty",defaultMessage:"Media Library is empty"}:{id:"header.actions.no-permissions",defaultMessage:"No permissions to view"},Ae=({canCreate:s,isFiltering:a,canRead:o,onActionClick:n})=>{const{formatMessage:l}=v(),i=Js({isFiltering:a,canCreate:s,canRead:o});return e.jsx(Fs,{icon:o?void 0:Cs,action:s&&!a&&e.jsx(L,{variant:"secondary",startIcon:e.jsx(Z,{}),onClick:n,children:l({id:d("header.actions.add-assets"),defaultMessage:"Add new assets"})}),content:l({...i,id:d(i.id)})})};Ae.propTypes={canCreate:f.bool.isRequired,canRead:f.bool.isRequired,isFiltering:f.bool.isRequired,onActionClick:f.func.isRequired};const Ks=()=>{const[s,a]=y.useState(!1),{formatMessage:o}=v(),{trackUsage:n}=ke(),[{query:l},i]=O(),g=l?.filters?.$and||[],h=c=>{i({filters:{$and:c},page:1})},p=c=>{n("didFilterMediaLibraryElements",{location:"content-manager",filter:Object.keys(c[c.length-1])[0]}),i({filters:{$and:c},page:1})};return e.jsxs(be.Root,{open:s,onOpenChange:a,children:[e.jsx(be.Trigger,{children:e.jsx(L,{variant:"tertiary",startIcon:e.jsx(Ms,{}),size:"S",children:o({id:"app.utils.filters",defaultMessage:"Filters"})})}),e.jsx(Ss,{displayedFilters:ye,filters:g,onSubmit:p,onToggle:a}),e.jsx(ks,{appliedFilters:g,filtersSchema:ye,onRemoveFilter:h})]})},oe=({breadcrumbs:s,canCreate:a,folder:o,onToggleEditFolderDialog:n,onToggleUploadAssetDialog:l})=>{const{formatMessage:i}=v(),{pathname:g}=Se(),[{query:h}]=O(),p={...h,folder:o?.parent?.id??void 0,folderPath:o?.parent?.path??void 0};return e.jsx($.Header,{title:i({id:d("plugin.name"),defaultMessage:"Media Library"}),subtitle:s&&o&&e.jsx(Ls,{tag:"nav",label:i({id:d("header.breadcrumbs.nav.label"),defaultMessage:"Folders navigation"}),breadcrumbs:s,currentFolderId:o?.id}),navigationAction:o&&e.jsx(Rs,{tag:ws,startIcon:e.jsx(As,{}),to:`${g}?${Re.stringify(p,{encode:!1})}`,children:i({id:d("header.actions.folder-level-up"),defaultMessage:"Back"})}),primaryAction:a&&e.jsxs(Q,{gap:2,children:[e.jsx(L,{startIcon:e.jsx(Z,{}),variant:"secondary",onClick:n,children:i({id:d("header.actions.add-folder"),defaultMessage:"Add new folder"})}),e.jsx(L,{startIcon:e.jsx(Z,{}),onClick:l,children:i({id:d("header.actions.add-assets"),defaultMessage:"Add new assets"})})]})})};oe.defaultProps={breadcrumbs:!1,folder:null};oe.propTypes={breadcrumbs:f.oneOfType([Ge,f.bool]),canCreate:f.bool.isRequired,folder:k,onToggleEditFolderDialog:f.func.isRequired,onToggleUploadAssetDialog:f.func.isRequired};const Xs=Y(U)`
  height: 3.2rem;
  display: flex;
  align-items: center;
`,Ce=Y(ee)`
  max-width: 100%;
`,Me=Y(U)`
  svg {
    path {
      fill: ${({theme:s})=>s.colors.neutral500};
    }
  }
`,Zs=()=>{const s=We(),{canRead:a,canCreate:o,canUpdate:n,canCopyLink:l,canDownload:i,canConfigureView:g,isLoading:h}=Je(),p=y.useRef(),{formatMessage:c}=v(),{pathname:u}=Se(),{trackUsage:M}=ke(),[{query:r},S]=O(),m=!!(r._q||r.filters),[T,Ee]=Ke(Xe.view,P.GRID),R=T===P.GRID,{data:F,isLoading:Te,errors:De}=Ze({skipWhen:!a,query:r}),{data:Be,isLoading:Ie,errors:Pe}=Ye({enabled:a&&F?.pagination?.page===1&&!es(r),query:r}),{data:z,isLoading:ne,error:$e}=ss(r?.folder,{enabled:a&&!!r?.folder});$e?.response?.status===404&&s(u);const D=Be?.map(t=>({...t,type:"folder",folderURL:E(u,r,t.id),isSelectable:n}))??[],x=D?.length||0,B=F?.results?.map(t=>({...t,type:"asset",isSelectable:n}))||[],j=B?.length??0,qe=F?.pagination?.total,Oe=ne||Ie||h||Te,[ie,Ue]=y.useState(!1),[re,le]=y.useState(!1),[V,G]=y.useState(void 0),[_,de]=y.useState(void 0),[C,{selectOne:I,selectAll:ce}]=ts(["type","id"],[]),ue=C?.length>0&&C?.length!==j+x,H=()=>Ue(t=>!t),fe=({created:t=!1}={})=>{t&&r?.page!=="1"&&S({...r,page:1}),le(A=>!A)},ge=(t,A)=>{t&&M("didSelectAllMediaLibraryElements"),ce(A)},pe=t=>{M("didSortMediaLibraryElements",{location:"upload",sort:t}),S({sort:t})},he=t=>{de(t),le(!0)},Qe=t=>{de(null),fe(t),p.current&&p.current.focus()},me=t=>{t===j&&F.pagination.page===F.pagination.pageCount&&F.pagination.page>1&&S({...r,page:F.pagination.page-1})},ze=()=>{ce(),me(C.length)};return Oe?e.jsx(w.Loading,{}):De||Pe?e.jsx(w.Error,{}):e.jsxs($.Root,{children:[e.jsxs(w.Main,{children:[e.jsx(oe,{breadcrumbs:!ne&&Hs(z,{pathname:u,query:r}),canCreate:o,onToggleEditFolderDialog:fe,onToggleUploadAssetDialog:H,folder:z}),e.jsx($.Action,{startActions:e.jsxs(e.Fragment,{children:[n&&R&&(j>0||x>0)&&e.jsx(Xs,{paddingLeft:2,paddingRight:2,background:"neutral0",hasRadius:!0,borderColor:"neutral200",children:e.jsx(Le,{"aria-label":c({id:d("bulk.select.label"),defaultMessage:"Select all folders & assets"}),checked:ue?"indeterminate":(j>0||x>0)&&C.length===j+x,onCheckedChange:t=>ge(t,[...B,...D])})}),a&&R&&e.jsx(as,{value:r?.sort,onChangeSort:pe}),a&&e.jsx(Ks,{})]}),endActions:e.jsxs(e.Fragment,{children:[g?e.jsx(Me,{paddingTop:1,paddingBottom:1,children:e.jsx(W,{tag:os,to:{pathname:`${u}/configuration`,search:Re.stringify(r,{encode:!1})},label:c({id:"app.links.configure-view",defaultMessage:"Configure the view"}),children:e.jsx(ns,{})})}):null,e.jsx(Me,{paddingTop:1,paddingBottom:1,children:e.jsx(W,{label:c(R?{id:d("view-switch.list"),defaultMessage:"List View"}:{id:d("view-switch.grid"),defaultMessage:"Grid View"}),onClick:()=>Ee(R?P.LIST:P.GRID),children:R?e.jsx(is,{}):e.jsx(rs,{})})}),e.jsx(ls,{label:c({id:d("search.label"),defaultMessage:"Search for an asset"}),trackedEvent:"didSearchMediaLibraryElements",trackedEventDetails:{location:"upload"}})]})}),e.jsxs($.Content,{children:[C.length>0&&e.jsx(ae,{currentFolder:z,selected:C,onSuccess:ze}),x===0&&j===0&&e.jsx(Ae,{canCreate:o,canRead:a,isFiltering:m,onActionClick:H}),a&&!R&&(j>0||x>0)&&e.jsx(ds,{assetCount:j,folderCount:x,indeterminate:ue,onChangeSort:pe,onChangeFolder:(t,A)=>s(E(u,r,{folder:t,folderPath:A})),onEditAsset:G,onEditFolder:he,onSelectOne:I,onSelectAll:ge,rows:[...D,...B],selected:C,shouldDisableBulkSelect:!n,sortQuery:r?.sort??""}),a&&R&&e.jsxs(e.Fragment,{children:[x>0&&e.jsx(cs,{title:(m&&j>0||!m)&&c({id:d("list.folders.title"),defaultMessage:"Folders ({count})"},{count:x})||"",children:D.map(t=>{const Ve=!!C.filter(({type:N})=>N==="folder").find(N=>N.id===t.id),xe=E(u,r,{folder:t?.id,folderPath:t?.path});return e.jsx(X.Item,{col:3,direction:"column",alignItems:"stretch",children:e.jsx(us,{ref:_&&t.id===_.id?p:void 0,ariaLabel:t.name,id:`folder-${t.id}`,to:xe,startAction:I&&t.isSelectable?e.jsx(Ns,{"data-testid":`folder-checkbox-${t.id}`,checked:Ve,onCheckedChange:()=>I(t)}):null,cardActions:e.jsx(W,{"aria-label":c({id:d("list.folder.edit"),defaultMessage:"Edit folder"}),onClick:()=>he(t),children:e.jsx(fs,{})}),children:e.jsx(gs,{children:e.jsx(ps,{to:xe,children:e.jsxs(Q,{tag:"h2",direction:"column",alignItems:"start",maxWidth:"100%",children:[e.jsxs(Ce,{fontWeight:"semiBold",textColor:"neutral800",ellipsis:!0,children:[t.name,e.jsx(hs,{children:":"})]}),e.jsx(Ce,{tag:"span",textColor:"neutral600",variant:"pi",ellipsis:!0,children:c({id:d("list.folder.subtitle"),defaultMessage:"{folderCount, plural, =0 {# folder} one {# folder} other {# folders}}, {filesCount, plural, =0 {# asset} one {# asset} other {# assets}}"},{folderCount:t.children.count,filesCount:t.files.count})})]})})})})},`folder-${t.id}`)})}),j>0&&x>0&&e.jsx(U,{paddingTop:6,paddingBottom:4,children:e.jsx(ms,{})}),j>0&&e.jsx(xs,{assets:B,onEditAsset:G,onSelectAsset:I,selectedAssets:C.filter(({type:t})=>t==="asset"),title:(!m||m&&x>0)&&F?.pagination?.page===1&&c({id:d("list.assets.title"),defaultMessage:"Assets ({count})"},{count:qe})||""})]}),e.jsxs(J.Root,{...F.pagination,children:[e.jsx(J.PageSize,{}),e.jsx(J.Links,{})]})]})]}),ie&&e.jsx(js,{open:ie,onClose:H,trackedLocation:"upload",folderId:r?.folder}),re&&e.jsx(bs,{open:re,onClose:Qe,folder:_,parentFolderId:r?.folder,location:"upload"}),V&&e.jsx(ys,{onClose:t=>{t===null&&me(1),G(void 0)},open:!!V,asset:V,canUpdate:n,canCopyLink:l,canDownload:i,trackedLocation:"upload"})]})},Ys=y.lazy(()=>_e(()=>import("./index-C9ULowyk-BJkHGaYY.js"),__vite__mapDeps([0,1,2]))),st=()=>{const{config:{isLoading:s,isError:a,data:o}}=He(),[{rawQuery:n},l]=O(),{formatMessage:i}=v(),g=i({id:d("plugin.name"),defaultMessage:"Media Library"});return y.useEffect(()=>{s||a||n||l({sort:o.sort,page:1,pageSize:o.pageSize})},[s,a,o,n,l]),s?e.jsxs(e.Fragment,{children:[e.jsx(w.Title,{children:g}),e.jsx(w.Loading,{})]}):e.jsx(w.Main,{children:n?e.jsx(y.Suspense,{fallback:e.jsx(w.Loading,{}),children:e.jsxs(Ne,{children:[e.jsx(je,{index:!0,element:e.jsx(Zs,{})}),e.jsx(je,{path:"configuration",element:e.jsx(Ys,{config:o})})]})}):null})};export{st as default};
