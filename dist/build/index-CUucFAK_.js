import{fY as f,h as u,r as h}from"./strapi-Bo_S02YF.js";/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md.
 */function v(){const n={resolve:null,promise:null};return n.promise=new Promise(e=>{n.resolve=e}),n}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md.
 */function R(n){let e=null;return(...t)=>(e||(e={current:n(...t)}),e.current)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md.
 */const c=new Array(256).fill("").map((n,e)=>("0"+e.toString(16)).slice(-2));function S(){const[n,e,t,r]=crypto.getRandomValues(new Uint32Array(4));return"e"+c[n>>0&255]+c[n>>8&255]+c[n>>16&255]+c[n>>24&255]+c[e>>0&255]+c[e>>8&255]+c[e>>16&255]+c[e>>24&255]+c[t>>0&255]+c[t>>8&255]+c[t>>16&255]+c[t>>24&255]+c[r>>0&255]+c[r>>8&255]+c[r>>16&255]+c[r>>24&255]}var W=Object.defineProperty,M=(n,e,t)=>e in n?W(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,l=(n,e,t)=>M(n,typeof e!="symbol"?e+"":e,t);/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md.
 */const g=class E{constructor(e,t){l(this,"_lifecycle"),l(this,"_element"),l(this,"_releaseLock",null),l(this,"_value",null),l(this,"_afterMountCallbacks",[]),l(this,"_state",{destroyedBeforeInitialization:!1,mountingInProgress:null}),l(this,"release",R(()=>{const{_releaseLock:r,_state:o,_element:a,_lifecycle:i}=this;o.mountingInProgress?o.mountingInProgress.then(()=>i.unmount({element:a,mountResult:this.value})).catch(s=>{console.error("Semaphore unmounting error:",s)}).then(r.resolve).then(()=>{this._value=null}):(o.destroyedBeforeInitialization=!0,r.resolve())})),this._element=e,this._lifecycle=t,this._lock()}get value(){return this._value}unsafeSetValue(e){this._value=e,this._afterMountCallbacks.forEach(t=>t(e)),this._afterMountCallbacks=[]}runAfterMount(e){const{_value:t,_afterMountCallbacks:r}=this;t?e(t):r.push(e)}_lock(){const{_semaphores:e}=E,{_state:t,_element:r,_lifecycle:o}=this,a=e.get(r)||Promise.resolve(null),i=v();this._releaseLock=i;const s=a.then(()=>t.destroyedBeforeInitialization?Promise.resolve(void 0):(t.mountingInProgress=o.mount().then(d=>(d&&this.unsafeSetValue(d),d)),t.mountingInProgress)).then(async d=>{d&&o.afterMount&&await o.afterMount({element:r,mountResult:d})}).then(()=>i.promise).catch(d=>{console.error("Semaphore mounting error:",d)}).then(()=>{e.get(r)===s&&e.delete(r)});e.set(r,s)}};l(g,"_semaphores",new Map);let x=g;/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md.
 */const I="$__CKEditorReactContextMetadata";function D(n,e){return{...e,[I]:n}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md.
 */const L=f.createContext(null),T=n=>!!n&&typeof n=="object"&&"status"in n&&["initializing","initialized","error"].includes(n.status),y=n=>e=>T(e)&&e.status===n,_=y("initializing"),k=n=>y("initialized")(n)&&n.watchdog.state==="ready";/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md.
 */const p="Lock from React integration (@ckeditor/ckeditor5-react)";class C extends f.Component{constructor(e){super(e),l(this,"domContainer",f.createRef()),l(this,"editorSemaphore",null),this._checkVersion()}_checkVersion(){const{CKEDITOR_VERSION:e}=window;if(!e)return console.warn('Cannot find the "CKEDITOR_VERSION" in the "window" scope.');const[t]=e.split(".").map(Number);t>=42||e.startsWith("0.0.0")||console.warn("The <CKEditor> component requires using CKEditor 5 in version 42+ or nightly build.")}get _semaphoreValue(){const{editorSemaphore:e}=this;return e?e.value:null}get watchdog(){const{_semaphoreValue:e}=this;return e?e.watchdog:null}get editor(){const{_semaphoreValue:e}=this;return e?e.instance:null}shouldComponentUpdate(e){const{props:t,editorSemaphore:r}=this;return e.id!==t.id||e.disableWatchdog!==t.disableWatchdog?!0:(r&&(r.runAfterMount(({instance:o})=>{this._shouldUpdateEditorData(t,e,o)&&o.data.set(e.data)}),"disabled"in e&&r.runAfterMount(({instance:o})=>{e.disabled?o.enableReadOnlyMode(p):o.disableReadOnlyMode(p)})),!1)}componentDidMount(){_(this.context)||this._initLifeCycleSemaphore()}componentDidUpdate(){_(this.context)||this._initLifeCycleSemaphore()}componentWillUnmount(){this._unlockLifeCycleSemaphore()}_unlockLifeCycleSemaphore(){this.editorSemaphore&&(this.editorSemaphore.release(),this.editorSemaphore=null)}_initLifeCycleSemaphore(){this._unlockLifeCycleSemaphore(),this.editorSemaphore=new x(this.domContainer.current,{mount:async()=>this._initializeEditor(),afterMount:({mountResult:e})=>{const{onReady:t}=this.props;t&&this.domContainer.current!==null&&t(e.instance)},unmount:async({element:e,mountResult:t})=>{const{onAfterDestroy:r}=this.props;try{await this._destroyEditor(t),e.innerHTML=""}finally{r&&r(t.instance)}}})}render(){return f.createElement("div",{ref:this.domContainer})}async _initializeEditor(){if(this.props.disableWatchdog)return{instance:await this._createEditor(this.domContainer.current,this._getConfig()),watchdog:null};const e=k(this.context)?new V(this.context.watchdog):new this.props.editor.EditorWatchdog(this.props.editor,this.props.watchdogConfig),t={current:0};return e.setCreator(async(r,o)=>{var a;const{editorSemaphore:i}=this,{onAfterDestroy:s}=this.props;t.current>0&&s&&((a=i?.value)!=null&&a.instance)&&s(i.value.instance);const d=await this._createEditor(r,o);return i&&t.current>0&&(i.unsafeSetValue({instance:d,watchdog:e}),setTimeout(()=>{this.props.onReady&&this.props.onReady(e.editor)})),t.current++,d}),e.on("error",(r,{error:o,causesRestart:a})=>{(this.props.onError||console.error)(o,{phase:"runtime",willEditorRestart:a})}),await e.create(this.domContainer.current,this._getConfig()).catch(r=>{(this.props.onError||console.error)(r,{phase:"initialization",willEditorRestart:!1})}),{watchdog:e,instance:e.editor}}_createEditor(e,t){const{contextItemMetadata:r}=this.props;return r&&(t=D(r,t)),this.props.editor.create(e,t).then(o=>{if("disabled"in this.props){/* istanbul ignore else -- @preserve */this.props.disabled&&o.enableReadOnlyMode(p)}const a=o.model.document,i=o.editing.view.document;return a.on("change:data",s=>{/* istanbul ignore else -- @preserve */this.props.onChange&&this.props.onChange(s,o)}),i.on("focus",s=>{/* istanbul ignore else -- @preserve */this.props.onFocus&&this.props.onFocus(s,o)}),i.on("blur",s=>{/* istanbul ignore else -- @preserve */this.props.onBlur&&this.props.onBlur(s,o)}),o})}async _destroyEditor(e){const{watchdog:t,instance:r}=e;return new Promise((o,a)=>{/* istanbul ignore next -- @preserve */setTimeout(async()=>{try{if(t)return await t.destroy(),o();if(r)return await r.destroy(),o();o()}catch(i){console.error(i),a(i)}})})}_shouldUpdateEditorData(e,t,r){return!(e.data===t.data||r.data.get()===t.data)}_getConfig(){const e=this.props.config||{};return this.props.data&&e.initialData&&console.warn("Editor data should be provided either using `config.initialData` or `content` property. The config value takes precedence over `content` property and will be used when both are specified."),{...e,initialData:e.initialData||this.props.data||""}}}l(C,"contextType",L);l(C,"propTypes",{editor:u.func.isRequired,data:u.string,config:u.object,disableWatchdog:u.bool,watchdogConfig:u.object,onChange:u.func,onReady:u.func,onFocus:u.func,onBlur:u.func,onError:u.func,disabled:u.bool,id:u.any});class V{constructor(e){l(this,"_contextWatchdog"),l(this,"_id"),l(this,"_creator"),this._contextWatchdog=e,this._id=S()}setCreator(e){this._creator=e}create(e,t){return this._contextWatchdog.add({sourceElementOrData:e,config:t,creator:this._creator,id:this._id,type:"editor"})}on(e,t){this._contextWatchdog.on("itemError",(r,{itemId:o,error:a})=>{o===this._id&&t(null,{error:a,causesRestart:void 0})})}destroy(){return this._contextWatchdog.state==="ready"?this._contextWatchdog.remove(this._id):Promise.resolve()}get editor(){return this._contextWatchdog.getItem(this._id)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md.
 */function w(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}const A=h.memo(h.forwardRef(({id:n,semaphore:e,rootName:t},r)=>{const o=h.useRef(null);return h.useEffect(()=>{let a,i;return e.runAfterMount(({instance:s})=>{if(!o.current)return;i=s;const{ui:d,model:b}=i,m=b.document.getRoot(t);m&&i.ui.getEditableElement(t)&&i.detachEditable(m),a=d.view.createEditable(t,o.current),d.addEditable(a),s.editing.view.forceRender()}),()=>{if(i&&i.state!=="destroyed"&&o.current){const s=i.model.document.getRoot(t);/* istanbul ignore else -- @preserve */s&&i.detachEditable(s)}}},[e.revision]),f.createElement("div",{key:e.revision,id:n,ref:w(r,o)})}));A.displayName="EditorEditable";const z=h.forwardRef(({editor:n},e)=>{const t=h.useRef(null);return h.useEffect(()=>{const r=t.current;if(!n||!r)return;const o=n.ui.view.toolbar.element;return r.appendChild(o),()=>{r.contains(o)&&r.removeChild(o)}},[n&&n.id]),f.createElement("div",{ref:w(t,e)})});z.displayName="EditorToolbarWrapper";export{C};
