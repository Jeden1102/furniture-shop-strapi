import{ar as N,aR as q,u as G,q as O,cG as U,cJ as k,cD as Q,r as R,a as e,P as d,bd as Y,a0 as H,ez as J,eA as _,eB as m,eC as j,U as c,eD as $,eE as K,d as W,bq as X,w as Z,cB as ee,F as P,B as te,eF as se,cA as ae}from"./strapi-Bo_S02YF.js";import{a as ne,f as ie,t as re,g as I}from"./Field-D-mgn1tH-CRi-F1lI.js";import"./Relations-BIGPMSW4-Cyqvvrc7.js";import"./useDragAndDrop-DdHgKsqq-NA1Z27sO.js";import"./relations-BlpLgngh-CosOSXGb.js";import"./getEmptyImage-CjqolaH3.js";import"./ComponentIcon-u4bIXTFY-CmdYnx3u.js";import"./objects-D6yBsdmx-BLDllho3.js";import"./useDebounce-DmuSJIF3-CLyVdlKi.js";const oe=a=>R.useEffect(a,de),de=[],S=({layout:a})=>e.jsx(P,{direction:"column",alignItems:"stretch",gap:6,children:a.map((n,o)=>{if(n.some(s=>s.some(t=>t.type==="dynamiczone"))){const[s]=n,[t]=s;return e.jsx(c.Root,{gap:4,children:e.jsx(c.Item,{col:12,s:12,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(I,{...t})})},t.name)}return e.jsx(te,{hasRadius:!0,background:"neutral0",shadow:"tableShadow",paddingLeft:6,paddingRight:6,paddingTop:6,paddingBottom:6,borderColor:"neutral150",children:e.jsx(P,{direction:"column",alignItems:"stretch",gap:6,children:n.map((s,t)=>e.jsx(c.Root,{gap:4,children:s.map(({size:r,...u})=>e.jsx(c.Item,{col:r,s:12,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(I,{...u})},u.name))},t))})},o)})}),ce=()=>{const a=N(),[{query:{status:n}},o]=q({status:"draft"}),{formatMessage:s}=G(),{toggleNotification:t}=O(),{document:r,meta:u,isLoading:D,schema:l,components:g,collectionType:T,id:C,model:v,hasError:A}=U(),p=l?.options?.draftAndPublish??!1;oe(()=>{a?.state&&"error"in a.state&&t({type:"danger",message:a.state.error,timeout:5e3})});const B=k("EditViewPage",i=>i.isLoading),x=T===se,h=!C&&!x,{isLoading:F,edit:{layout:b,settings:{mainField:f}}}=Q(v),{isLazyLoading:M}=ne([]),w=B||D||F||M,L=R.useMemo(()=>{if(!r&&!h&&!x||!l)return;const i=r?.id?r:ie(l,g);return re(l,g)(i)},[r,h,x,l,g]);if(A)return e.jsx(d.Error,{});if(w&&!r?.documentId)return e.jsx(d.Loading,{});if(!L)return e.jsx(d.Error,{});const z=i=>{(i==="published"||i==="draft")&&o({status:i},"push",!0)},y=f!=="id"&&r?.[f]?r[f]:"Untitled";return e.jsxs(Y,{paddingLeft:10,paddingRight:10,children:[e.jsx(d.Title,{children:`${y}`}),e.jsx(H,{disabled:p&&n==="published",initialValues:L,method:h?"POST":"PUT",validate:(i,V)=>J(l?.attributes,g,{status:n,...V}).validate(i,{abortEarly:!1}),children:({resetForm:i})=>e.jsxs(e.Fragment,{children:[e.jsx(_,{isCreating:h,status:p?ue(r,u):void 0,title:y}),e.jsxs(m.Root,{variant:"simple",value:n,onValueChange:z,children:[e.jsx(m.List,{"aria-label":s({id:j("containers.edit.tabs.label"),defaultMessage:"Document status"}),children:p?e.jsxs(e.Fragment,{children:[e.jsx(E,{value:"draft",children:s({id:j("containers.edit.tabs.draft"),defaultMessage:"draft"})}),e.jsx(E,{disabled:!u||u.availableStatus.length===0,value:"published",children:s({id:j("containers.edit.tabs.published"),defaultMessage:"published"})})]}):null}),e.jsxs(c.Root,{paddingTop:8,gap:4,children:[e.jsxs(c.Item,{col:9,s:12,direction:"column",alignItems:"stretch",children:[e.jsx(m.Content,{value:"draft",children:e.jsx(S,{layout:b})}),e.jsx(m.Content,{value:"published",children:e.jsx(S,{layout:b})})]}),e.jsx(c.Item,{col:3,s:12,direction:"column",alignItems:"stretch",children:e.jsx($,{})})]})]}),e.jsx(K,{onProceed:i})]})})]})},E=W(m.Trigger)`
  text-transform: uppercase;
`,ue=(a,n)=>{const o=a?.status,s=n?.availableStatus??[];return o?o==="draft"&&s.find(t=>t.publishedAt!==null)?"published":o:"draft"},ye=()=>{const{slug:a=""}=X(),{permissions:n=[],isLoading:o,error:s}=Z(ae.map(t=>({action:t,subject:a})));return o?e.jsx(d.Loading,{}):s||!a?e.jsx(d.Error,{}):e.jsx(d.Protect,{permissions:n,children:({permissions:t})=>e.jsx(ee,{permissions:t,children:e.jsx(ce,{})})})};export{ce as EditViewPage,ye as ProtectedEditViewPage};
