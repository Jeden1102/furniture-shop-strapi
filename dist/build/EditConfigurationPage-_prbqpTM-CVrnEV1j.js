import{br as T,u as I,q as v,t as A,cG as N,cK as D,fb as k,r as w,eW as G,a as s,P as c}from"./strapi-Bo_S02YF.js";import{C as O,T as R}from"./Form-BxyeWiXW-ob_tjZAy.js";import{u as U}from"./hooks-E5u1mcgM-Dcix-1lq.js";import{s as q}from"./objects-D6yBsdmx-BLDllho3.js";import"./useDragAndDrop-DdHgKsqq-NA1Z27sO.js";import"./ComponentIcon-u4bIXTFY-CmdYnx3u.js";import"./FieldTypeIcon-CMlNO8PE-BesH_IOt.js";import"./getEmptyImage-CjqolaH3.js";const H=()=>{const{trackUsage:o}=T(),{formatMessage:n}=I(),{toggleNotification:a}=v(),{_unstableFormatAPIError:u}=A(),{isLoading:F,schema:y,model:L}=N(),{isLoading:S,error:h,list:E,edit:g}=D(),{fieldSizes:x,error:d,isLoading:_,isFetching:j}=k(void 0,{selectFromResult:e=>{const l=Object.entries(e.data?.fieldSizes??{}).reduce((r,[t,{default:i}])=>(r[t]=i,r),{});return{isFetching:e.isFetching,isLoading:e.isLoading,error:e.error,fieldSizes:l}}});w.useEffect(()=>{d&&a({type:"danger",message:u(d)})},[d,u,a]);const C=F||S||_||j,[M]=G(),P=async e=>{try{o("willSaveContentTypeLayout");const l=Object.entries(E.metadatas).reduce((t,[i,{mainField:m,...f}])=>{const b=g.metadatas[i],{__temp_key__:K,size:Q,name:V,...z}=e.layout.flatMap(p=>p.children).find(p=>p.name===i)??{};return t[i]={edit:{...b,...z},list:f},t},{}),r=await M({layouts:{edit:e.layout.map(t=>t.children.reduce((i,{name:m,size:f})=>m!==R?[...i,{name:m,size:f}]:i,[])),list:E.layout.map(t=>t.name)},settings:q(e.settings,"displayName",void 0),metadatas:l,uid:L});"data"in r?(o("didEditEditSettings"),a({type:"success",message:n({id:"notification.success.saved",defaultMessage:"Saved"})})):a({type:"danger",message:u(r.error)})}catch{a({type:"danger",message:n({id:"notification.error",defaultMessage:"An error occurred"})})}};return C?s.jsx(c.Loading,{}):d||h||!y?s.jsx(c.Error,{}):s.jsxs(s.Fragment,{children:[s.jsx(c.Title,{children:`Configure ${g.settings.displayName} Edit View`}),s.jsx(O,{onSubmit:P,attributes:y.attributes,fieldSizes:x,layout:g})]})},te=()=>{const o=U(n=>n.admin_app.permissions.contentManager?.collectionTypesConfigurations);return s.jsx(c.Protect,{permissions:o,children:s.jsx(H,{})})};export{H as EditConfigurationPage,te as ProtectedEditConfigurationPage};
